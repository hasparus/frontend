{"ast":null,"code":"import { setCookie } from \"nookies\";\nimport { auth } from \"../../src/app/auth\";\nimport { noop } from \"../../src/lib/noop\";\nexport default async function login(req, res) {\n  try {\n    // we want to postpone the redirect\n    const {\n      end,\n      writeHead\n    } = res;\n    res.end = noop;\n    let writeArgs = [];\n\n    res.writeHead = (...args) => {\n      writeArgs = args;\n      return res;\n    };\n\n    await auth.handleLogin(req, res, {\n      authParams: {\n        scope: \"openid email profile\"\n      }\n    });\n    setCookie({\n      res\n    }, \"zm|redirectTo\", req.headers.referer || \"/\", {});\n    res.writeHead = writeHead;\n    res.end = end;\n    res.writeHead(...writeArgs).end();\n  } catch (error) {\n    res.status(error.status || 500).end(error.message);\n  }\n}","map":{"version":3,"sources":["/home/hasparus/workspace/zagrajmy/frontend/packages/app/pages/api/login.ts"],"names":["setCookie","auth","noop","login","req","res","end","writeHead","writeArgs","args","handleLogin","authParams","scope","headers","referer","error","status","message"],"mappings":"AACA,SAASA,SAAT,QAA0B,SAA1B;AAEA,SAASC,IAAT,QAAqB,oBAArB;AACA,SAASC,IAAT,QAAqB,oBAArB;AAEA,eAAe,eAAeC,KAAf,CAAqBC,GAArB,EAA0CC,GAA1C,EAAgE;AAC7E,MAAI;AACF;AACA,UAAM;AAAEC,MAAAA,GAAF;AAAOC,MAAAA;AAAP,QAAqBF,GAA3B;AACAA,IAAAA,GAAG,CAACC,GAAJ,GAAUJ,IAAV;AACA,QAAIM,SAAoB,GAAG,EAA3B;;AACAH,IAAAA,GAAG,CAACE,SAAJ,GAAgB,CAAC,GAAGE,IAAJ,KAAwB;AACtCD,MAAAA,SAAS,GAAGC,IAAZ;AACA,aAAOJ,GAAP;AACD,KAHD;;AAKA,UAAMJ,IAAI,CAACS,WAAL,CAAiBN,GAAjB,EAAsBC,GAAtB,EAA2B;AAC/BM,MAAAA,UAAU,EAAE;AAAEC,QAAAA,KAAK,EAAE;AAAT;AADmB,KAA3B,CAAN;AAIAZ,IAAAA,SAAS,CACN;AAAEK,MAAAA;AAAF,KADM,EAEP,eAFO,EAGPD,GAAG,CAACS,OAAJ,CAAYC,OAAZ,IAAuB,GAHhB,EAIP,EAJO,CAAT;AAOAT,IAAAA,GAAG,CAACE,SAAJ,GAAgBA,SAAhB;AACAF,IAAAA,GAAG,CAACC,GAAJ,GAAUA,GAAV;AACAD,IAAAA,GAAG,CAACE,SAAJ,CAAc,GAAIC,SAAlB,EAAkEF,GAAlE;AACD,GAxBD,CAwBE,OAAOS,KAAP,EAAc;AACdV,IAAAA,GAAG,CAACW,MAAJ,CAAWD,KAAK,CAACC,MAAN,IAAgB,GAA3B,EAAgCV,GAAhC,CAAoCS,KAAK,CAACE,OAA1C;AACD;AACF","sourcesContent":["import { NextApiResponse, NextApiRequest, NextPageContext } from \"next\";\nimport { setCookie } from \"nookies\";\n\nimport { auth } from \"../../src/app/auth\";\nimport { noop } from \"../../src/lib/noop\";\n\nexport default async function login(req: NextApiRequest, res: NextApiResponse) {\n  try {\n    // we want to postpone the redirect\n    const { end, writeHead } = res;\n    res.end = noop;\n    let writeArgs: unknown[] = [];\n    res.writeHead = (...args: unknown[]) => {\n      writeArgs = args;\n      return res;\n    };\n\n    await auth.handleLogin(req, res, {\n      authParams: { scope: \"openid email profile\" },\n    });\n\n    setCookie(\n      ({ res } as any) as NextPageContext,\n      \"zm|redirectTo\",\n      req.headers.referer || \"/\",\n      {}\n    );\n\n    res.writeHead = writeHead;\n    res.end = end;\n    res.writeHead(...(writeArgs as Parameters<typeof res.writeHead>)).end();\n  } catch (error) {\n    res.status(error.status || 500).end(error.message);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}